import os
import cv2
import pickle
import argparse
import numpy as np
import matplotlib.pyplot as plt


# need_to_interpolate_0 = [451, 3396, 3397, 3417, 4601,
#                          5534, 5536, 6627, 7937, 11127,
#                          11128, 11673, 13808, 13809,
#                          16999, 17000, 18763, 19392,
#                          21280, 21281]

# mannual_bbox_0 = [
#     [[239, 290, 264, 316], [292, 312, 317, 337], [316, 318, 340, 342]],  # frame 451
#     [[118, 419, 142, 443], [142, 425, 165, 448], [883, 186, 909, 212]],  # frame 3396
#     [[126, 431, 150, 455], [148, 426, 172, 451], [883, 186, 908, 212]],
#     [[295, 466, 320, 488], [297, 490, 321, 514], [883, 186, 909, 212]],
#     [[213, 435, 237, 460], [575, 510, 599, 535], [572, 545, 596, 572]],
#     [[200, 181, 226, 206], [656, 485, 680, 511], [656, 512, 680, 536]],
#     [[200, 181, 226, 206], [654, 483, 678, 510], [651, 511, 675, 535]],
#     [[621, 216, 644, 240], [621, 245, 645, 271], [808, 262, 832, 288]],
#     [[301, 63, 325, 87], [298, 88, 322, 112], [991, 527, 1015, 550]],
#     [[809, 331, 836, 357], [1019, 470, 1044, 494], [1045, 466, 1069, 489]],
#     [[806, 333, 832, 358], [1019, 470, 1044, 494], [1045, 466, 1069, 489]],
#     [[603, 381, 627, 407], [1016, 408, 1041, 432], [1040, 414, 1062, 437]],
#     [[115, 98, 137, 120], [138, 104, 161, 127], [244, 200, 268, 224]],
#     [[115, 97, 138, 120], [138, 104, 161, 127], [244, 200, 268, 224]],
#     [[432, 56, 456, 80], [841, 164, 866, 189], [484, 309, 509, 335]],
#     [[415, 68, 440, 91], [482, 303, 508, 329], [841, 164, 866, 188]],
#     [[919, 122, 945, 147], [519, 366, 544, 392], [974, 422, 1000, 445]],
#     [[481, 294, 507, 319], [882, 120, 906, 144], [885, 148, 909, 172]],
#     [[965, 139, 989, 163], [923, 457, 947, 483], [984, 410, 1009, 434]],
#     [[963, 139, 988, 163], [921, 458, 946, 483], [983, 409, 1006, 433]]
# ]

# need_to_interpolate_1 = [1785, 7330, 10334, 12404, 14938, 16624,
#                          16625, 19408, 19417, 20671, 27046,
#                          35928, 36752, 36753, 36754, 36757, 37630,
#                          38840, 39025, 39027, 39028, 39739, 39741]
#
# mannual_bbox_1 = [
#     [[459, 124, 482, 147], [462, 133, 485, 158], [616, 52, 640, 75]],  # frame 1785
#     [[303, 190, 330, 218], [297, 198, 323, 227], [187, 258, 215, 289]],
#     [[220, 297, 246, 317], [226, 262, 255, 292], [280, 205, 308, 235]],
#     [[193, 4, 213, 26], [228, 66, 252, 88], [223, 82, 244, 104]],
#     [[190, 4, 211, 25], [248, 294, 278, 317], [423, 171, 449, 199]],
#     [[423, 172, 448, 199], [523, 94, 548, 120], [622, 58, 646, 81]],
#     [[423, 172, 449, 198], [525, 95, 549, 120], [624, 57, 649, 81]],
#     [[397, 25, 419, 47], [123, 180, 151, 207], [438, 168, 462, 193]],
#     [[138, 178, 168, 202], [134, 191, 161, 218], [397, 25, 419, 47]],
#     [[536, 91, 558, 114], [549, 85, 569, 107], [461, 218, 488, 245]],
#     [[417, 96, 440, 120], [143, 197, 169, 223], [145, 210, 175, 236]],
#     [[263, 29, 281, 50], [622, 151, 648, 179], [623, 199, 649, 228]],
#     [[193, 130, 219, 155], [209, 186, 236, 214], [436, 119, 460, 145]],
#     [[436, 119, 460, 145], [182, 127, 210, 154], [193, 190, 221, 218]],
#     [[436, 119, 460, 145], [172, 127, 200, 154], [178, 193, 203, 221]],
#     [[436, 119, 460, 145], [143, 119, 170, 147], [126, 202, 155, 230]],
#     [[321, 95, 338, 113], [395, 60, 418, 84], [523, 21, 546, 44]],
#     [[475, 37, 494, 57], [170, 44, 191, 67], [303, 83, 327, 107]],
#     [[594, 191, 622, 218], [178, 44, 200, 65], [184, 53, 206, 74]],
#     [[600, 191, 627, 218], [181, 44, 203, 65], [181, 55, 204, 77]],
#     [[606, 192, 632, 220], [183, 43.5, 205, 62.5], [180, 56, 203, 78]],
#     [[599, 203, 627, 230], [247, 42, 270, 64.7], [198, 177.5, 228, 206.4]],
#     [[285, 184, 310, 211], [599, 203, 627, 230], [247, 42, 270, 64.7]],
# ]

need_to_interpolate_2 = [760, 20764, 36970, 37068, 50631, 50632, 85198]


mannual_bbox_2 = [
    [[781, 125, 805, 149], [840, 230, 865, 251], [864, 229, 889, 250]],
    [[345, 118, 369, 141], [769, 314, 791, 333], [862, 326, 887, 348]],
    [[703, 124, 726, 146], [749, 413, 769, 433], [826, 377, 851, 402]],
    [[116, 333, 141, 355], [701, 105, 724, 126], [703, 126, 726, 147]],
    [[684, 46, 706, 70], [738, 114, 762, 139], [776, 134.5, 796, 156]],
    [[684, 46, 706, 70], [742, 108, 764, 132], [803, 143, 824, 164]],
    [[807, 173, 830, 196], [851, 206, 874, 229], [844, 240, 865, 260]],
]


def arg_parse():
    parser = argparse.ArgumentParser(description='randomly select several images')
    # parser.add_argument('-i', '--input', required=True, type=str, help='Path to input directory')
    # parser.add_argument('-o', '--output', required=True, type=str, help='Path to input directory')
    args = parser.parse_args()
    return args


def main():
    i = 2
    im_folders = [f'data/ytb/raw_images/{i}/']
    anno_file_list = [f'data/ytb/post_images/{i}.pkl']

    for im_folder, anno_file in zip(im_folders, anno_file_list):
        with open(anno_file, 'rb') as f:
            anno_dict = pickle.load(f)
        annos = anno_dict['gt_bboxes']
        for idx, inter_frame in enumerate(need_to_interpolate_2):
            anno = annos[inter_frame]
            assert (anno == -1).all()
            # print(inter_frame)
            # plt.imshow(cv2.imread(os.path.join(im_folder, f'{inter_frame:06d}.jpg'))[..., ::-1])
            # print('done one')
            annos[inter_frame] = np.array(mannual_bbox_2[idx])
        anno_dict['gt_bboxes'] = annos
        with open(anno_file.replace(f'{i}', f'{i}_new'), 'wb') as f:
            pickle.dump(anno_dict, f, pickle.HIGHEST_PROTOCOL)


if __name__ == '__main__':
    main()
